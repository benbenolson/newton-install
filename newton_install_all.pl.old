#!/usr/bin/perl

use strict; use warnings;
use Cwd; use File::Copy;

# Builds the application given; returns if successful.
sub build {
  `cp -r tarballs/$_[0] buildir &> /dev/null`;
  if ($? != 0) { warn "ERROR: $_[0] tarball not found."; return 1; }
  `cp scripts/$_[0].sh buildir/$_[0]/$_[0].sh &> /dev/null`;
  if ($? != 0) { warn "ERROR: $_[0].sh not found."; return 1; }
  my $dir = cwd();
  chdir("buildir/" . $_[0]);
  `sh $_[0].sh`;
  chdir($dir);
  $?;
}

sub newton_install_all {
  if( !opendir(DIR, "./tarballs") ) { print "Tarballs directory not found. Bailing.\n"; die; }
  my @applications = grep { /^newton_/ } readdir DIR;
  my $tries = @applications;
  my $app;
  while($tries != 0) {
    $app = shift @applications;
    if(build($app) != 0) {
      push( @applications, $app);
    }
    $tries--;
  }
}

newton_install_all();
